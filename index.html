<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeLab - Instant Code Sharing</title>
    
    <!-- Compression Library -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>

    <style>
        :root {
            --primary: #00adb5;
            --background: #1a1a1a;
            --editor-bg: #2d2d2d;
        }

        /* ... ржкрзВрж░рзНржмрзЗрж░ CSS ржЕржкрж░рж┐ржмрж░рзНрждрж┐ржд ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>ЁЯФЧ CodeLab - Live Editor</h1>
        
        <div class="editor-container">
            <textarea id="codeEditor" placeholder="Enter your HTML, CSS & JS here..."></textarea>
            <div class="preview-container">
                <iframe 
                    id="livePreview" 
                    sandbox="allow-scripts allow-modals allow-forms allow-same-origin"
                ></iframe>
            </div>
        </div>

        <!-- ... ржмрж╛ржХрж┐ HTML ржЕржкрж░рж┐ржмрж░рзНрждрж┐ржд ... -->
    </div>

    <script>
        // Updated Preview Function
        function updatePreview() {
            try {
                const code = document.getElementById('codeEditor').value;
                const iframe = document.getElementById('livePreview');
                const blob = new Blob([code], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                iframe.src = url;
            } catch(e) {
                console.error('Preview Error:', e);
            }
        }

        // Fixed Link Generation
        function generateLink() {
            try {
                const code = document.getElementById('codeEditor').value;
                const compressed = LZString.compressToEncodedURIComponent(encodeURIComponent(code));
                const baseURL = window.location.href.split('#')[0];
                const shareLink = `${baseURL}#${compressed}`;
                
                document.getElementById('generatedLink').textContent = shareLink;
                navigator.clipboard.writeText(shareLink);
                alert('Link copied!');
            } catch(e) {
                console.error('Link Error:', e);
            }
        }

        // Fixed Load Function
        function loadFromHash() {
            try {
                if(window.location.hash) {
                    const compressed = window.location.hash.substring(1);
                    const decoded = LZString.decompressFromEncodedURIComponent(compressed);
                    const code = decodeURIComponent(decoded);
                    document.getElementById('codeEditor').value = code;
                    updatePreview();
                }
            } catch(e) {
                console.error('Load Error:', e);
            }
        }

        // Initialize
        window.onload = () => {
            loadFromHash();
            document.getElementById('codeEditor').addEventListener('input', updatePreview);
        };
    </script>
</body>
</html>
